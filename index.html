<script>
    const DATA_URL = 'https://raw.githubusercontent.com/shayholmes4/ScrollSurf/extension/data/awesome.txt';
    let allSites = [];
    let currentIndex = 0;
    const BATCH_SIZE = 10;

    async function loadData() {
        const response = await fetch(DATA_URL);
        const text = await response.text();
        allSites = text.split('\n').filter(line => line.trim()).map(line => {
            const [title, url] = line.split(',').map(s => s.trim());
            return { title, url };
        });
        shuffleArray(allSites);
        loadMore();
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function loadMore() {
        const list = document.getElementById('content-list');
        const loading = document.getElementById('loading');
        loading.style.display = 'block';
        setTimeout(() => {
            for (let i = 0; i < BATCH_SIZE && currentIndex < allSites.length; i++) {
                const site = allSites[currentIndex];
                const item = document.createElement('div');
                item.className = 'item';
                item.innerHTML = `<a href="${site.url}" target="_blank">${site.title || site.url}</a><p>Explore this random gem!</p>`;
                list.appendChild(item);
                currentIndex++;
            }
            loading.style.display = 'none';
        }, 500);
    }

    window.addEventListener('scroll', () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100) {
            loadMore();
        }
    });

    loadData();
</script>
